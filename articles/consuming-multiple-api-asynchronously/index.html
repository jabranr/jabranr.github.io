
  



  

<!doctype html>
<html lang="en" xmlns:fb="http://ogp.me/ns/fb#">
  <head>
    <meta charset="UTF-8" />
    <title>Consuming multiple APIs asynchronously - Jabran Rafique</title>
    <meta name="description" content="Full Stack Web Engineer, currently Front-End Tech Lead at Rated People" />
    <meta name="keywords" content="blog, jabran, rafique, html, css, javascript, react, php, full stack, front-end" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Consuming multiple APIs asynchronously - Jabran Rafique" />
    <meta property="og:description" content="Full Stack Web Engineer, currently Front-End Tech Lead at Rated People" />
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@jabranr">
    <meta name="twitter:creator" content="@jabranr">
    <meta name="twitter:title" content="Consuming multiple APIs asynchronously - Jabran Rafique">
    <meta name="twitter:description" content="Full Stack Web Engineer, currently Front-End Tech Lead at Rated People">
    <meta property="og:image" content="https://jabran.me/assets/images/icon-1024x1024.png" />
    <meta name="twitter:image" content="https://jabran.me/assets/images/icon-1024x1024.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="msapplication-TileImage" content="https://jabran.me/assets/images/apple-touch-icon-114x114.png" />
    <meta name="theme-color" content="#f55555" />
    
      <meta property="robots" content="all" />
      <meta property="og:url" content="https://jabran.me/articles/consuming-multiple-api-asynchronously/">
      <link rel="canonical" href="https://jabran.me/articles/consuming-multiple-api-asynchronously/" />
    
    <link rel="preconnect" href="https://www.googletagmanager.com" />
    <link rel="preconnect" href="https://www.google-analytics.com" />
    <link rel="manifest" href="https://jabran.me/manifest.json?v=1641647976332" />
    <link rel="icon" type="image/x-icon" href="https://jabran.me/assets/images/favicon.ico" />
    <link rel="apple-touch-icon" href="https://jabran.me/assets/images/apple-touch-icon-114x114.png" />

    <link href="https://jabran.me/assets/css/normalize.css?v=1641647976332" rel="stylesheet" />
    <link href="https://unpkg.com/prismjs@1.20.0/themes/prism-okaidia.css" rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link href="https://unpkg.com/prismjs@1.20.0/themes/prism-okaidia.css" rel="stylesheet"></noscript>
    <link href="https://jabran.me/assets/css/styles.css?v=1641647976332" rel="stylesheet" />


    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MHKHDT');</script>
    <!-- End Google Tag Manager -->
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MHKHDT"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <div class="wrapper">
      <header class="header container-fluid">
        <section class="container header_inner">
          
            <a class="h1 logo" href="/">Jabran Rafique</a>
          
        </section>
      </header>
      <main class="main">



<section class="container breadcrumbs">
  <a href="/">Home</a> &rsaquo; <a href="/articles/">Articles</a>
</section>

<section class="container-fluid">
  <section class="container post">
    <h1 class="article_header underlined">Consuming multiple APIs asynchronously</h1>
    <time datetime="2014-08-21" class="article_time">
      August 21, 2014 &bull; 5 minutes read
    </time>
    <section class="article_content">
      <div class="ads">
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4297681002419123" crossorigin="anonymous"></script>
        <!-- Banner ad -->
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-4297681002419123"
             data-ad-slot="6682049184"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
      </div>
      <p>Recently, I worked on few Facebook apps that utilized multiple Application Programming Interfaces(APIs) in addition to default <a href="https://developers.facebook.com/docs/graph-api/">Facebook Graph API</a>. Applications normally use provided Software Development Kits(SDKs) to consume an API. At front-end development, majority of developers, prefer to use JavaScript SDKs for such a purpose. Consuming multiple APIs can be tricky in single app sometime—especially when using their JavaScript SDKs.</p>
<p>There can be multiple reasons behind this tricky behaviour but an obvious one is not able to calculate the load time of an SDK. It can vary from app to app and even from page to page. Therefore, loading multiple SDKs and parallel consumption of their associated APIs, can lead to unexpected responses. For Facebook Graph API, most common examples are <a href="http://stackoverflow.com/search?q=fb.getloginstatus+called+before+fb.init">early call warnings for FB methods</a>.</p>
<blockquote>
<p>In an ideal world of APIs, their JavaScript SDKs will be loaded asynchronously – for almost 99.9% of the time – to make sure the priority loading of the app and a valid response is returned for any calls made to API.</p>
</blockquote>
<p><a href="http://j.mp/1ohip3T">USA Outdoors Adventure</a> app recognises its users by using Facebook Graph API and then loads their up-to-date status by consuming Graph, Google Maps and its own Outdoors Adventure(OA) API. The process flow is as following:</p>
<ul>
<li>Check user status (Graph API)</li>
<li>Confirm user registration (OA API)</li>
<li>Check user status and get user data (OA API)</li>
<li>Load user status (Google Maps API)</li>
</ul>
<p>To stick with this cascading flow, API calls need to be chained accordingly to avoid errors, unexpected results or early call warnings. So APIs call flow goes as following:</p>
<ul>
<li>Call Graph API</li>
<li>Call OA API as a callback to Graph API</li>
<li>Call Google Maps API as a callback to OA API</li>
<li>Setup front-end using final data in hand</li>
</ul>
<p>Here I will go through all these steps explaining how it works best by chaining calls for multiple APIs. <sup>1</sup></p>
<h2>Facebook Graph API</h2>
<p>This app uses Facebook user ID in order to identify and keep track of user progress. Facebook JavaScript SDK has built-in methods of returning asynchronous calls that can defer custom steps until SDKs are fully loaded so the relevant functions are available to the app. Here is quick overview with default Facebook SDK initialization code:</p>
<pre class="language-javascript"><code class="language-javascript">window<span class="token punctuation">.</span><span class="token function-variable function">fbAsyncInit</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	<span class="token constant">FB</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>		appId   <span class="token operator">:</span> <span class="token string">'1234567890'</span><span class="token punctuation">,</span><br>		xfbml   <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>		version <span class="token operator">:</span> <span class="token string">'v2.0'</span><br>	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token comment">// Callback function goes here</span><br>	<span class="token constant">FB</span><span class="token punctuation">.</span><span class="token function">getLoginStatus</span><span class="token punctuation">(</span>myCallbackFunc<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">d<span class="token punctuation">,</span> s<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>	<span class="token keyword">var</span> js<span class="token punctuation">,</span> fjs <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>	<span class="token keyword">if</span> <span class="token punctuation">(</span>d<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span><br>	js <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> js<span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span><br>	js<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"//connect.facebook.net/en_US/sdk.js"</span><span class="token punctuation">;</span><br>	fjs<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>js<span class="token punctuation">,</span> fjs<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> <span class="token string">'script'</span><span class="token punctuation">,</span> <span class="token string">'facebook-jssdk'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Passing a custom function <code>myCallbackFunc</code> in <code>FB.getLoginStatus(...)</code>, will have a deferred execution and will be served as callback.</p>
<p>Now depending on personal choice, that may or may not be an optimal workflow – so here is a better workflow by using <a href="http://jabran.me/projects/socialmedia-js">Socialmedia.js</a>. Making an exact similar call with <code>Socialmedia.js</code> could not be anymore simpler.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> myFbApp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socialmedia<span class="token punctuation">.</span>Facebook</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  appid<span class="token operator">:</span> <span class="token string">'12345678'</span><span class="token punctuation">,</span><br>  callback<span class="token operator">:</span> myCallbackFunc<br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2>Outdoors Adventure (OA) API</h2>
<p>Now that we have Facebook SDK ready to use as well as user status from Graph API. We can use user status to determine if user is connected to the app as yet so we can make use of OA API or ask user to connect otherwise.</p>
<p>A simple <code>jQuery.getJSON</code> call grabs user data from OA API. But first, we want user to authenticate the app by giving appropriate permissions so that we know who this user is. Here is the breakdown of complete scenario:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">myCallbackFunc</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	<span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">isConnectedUser</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span><br><br>		<span class="token constant">FB</span><span class="token punctuation">.</span><span class="token function">api</span><span class="token punctuation">(</span><span class="token string">'/me'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span><br><br>			<span class="token keyword">return</span><br>				$<span class="token punctuation">.</span><span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">'/api/user?uid=info.id&amp;token=secretToken'</span><span class="token punctuation">)</span><br><br>					<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span>loadGoogleMapsFunc<span class="token punctuation">)</span><span class="token punctuation">,</span><br><br>					<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">jqxhr<span class="token punctuation">,</span> textStatus<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span><br>						<span class="token comment">// handle errors here</span><br>					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token punctuation">}</span><br>	<span class="token keyword">else</span> <span class="token punctuation">{</span><br>		<span class="token constant">FB</span><span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>myCallbackFunc<span class="token punctuation">,</span> <span class="token punctuation">{</span> scope<span class="token operator">:</span> <span class="token string">'email'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">isConnectedUser</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	<span class="token keyword">return</span> <span class="token punctuation">(</span>response <span class="token operator">&amp;&amp;</span> response<span class="token punctuation">.</span>status <span class="token operator">&amp;&amp;</span> response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'connected'</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<h2>Google Maps API</h2>
<p>Now that we have the user identity, status and progress data in JSON format, we can utilize this information for a personalised Google Maps layout. Here is the breakdown to load Google Maps functions.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">loadGoogleMapsFunc</span><span class="token punctuation">(</span><span class="token parameter">json</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	<span class="token keyword">var</span> map <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>	mapOptions <span class="token operator">=</span> <span class="token punctuation">{</span><br>		center<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">google<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>LatLng</span><span class="token punctuation">(</span><span class="token number">35.589439</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">106.387605</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>		zoom<span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span><br>		disableDefaultUI<span class="token operator">:</span> <span class="token boolean">false</span><br>	<span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>	map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">google<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'mapCanvas'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mapOptions<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token comment">/**<br>	 * Using built-in event listener of Google Maps API, we can<br>	 * defer loading the data on map until map is fully loaded,<br>	 */</span><br><br>	google<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>event<span class="token punctuation">.</span><span class="token function">addListenerOnce</span><span class="token punctuation">(</span>map<span class="token punctuation">,</span> <span class="token string">'tiles_loaded'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>		<span class="token keyword">return</span> <span class="token function">setupLocationData</span><span class="token punctuation">(</span>map<span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><br><br><span class="token punctuation">}</span></code></pre>
<p>Google Maps is loaded now and ready to use. It is time to load user data to display on map. Here we go:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">setupLocationData</span><span class="token punctuation">(</span><span class="token parameter">map<span class="token punctuation">,</span> json</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	<span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> json<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>		<span class="token keyword">var</span> info <span class="token operator">=</span> json<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><br>		<span class="token keyword">var</span> marker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">google<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>Marker</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>			position<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">google<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>LatLng</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>lat<span class="token punctuation">,</span> info<span class="token punctuation">.</span>lng<span class="token punctuation">)</span><span class="token punctuation">,</span><br>			id<span class="token operator">:</span> info<span class="token punctuation">.</span>id<span class="token punctuation">,</span><br>			info<span class="token operator">:</span> info<span class="token punctuation">,</span><br>			map<span class="token operator">:</span> map<br>		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>This process may go on as we add more and more interactivity into this. We can also display a loading status or animated progress cricle between calls so to provide a better user experience and so on.</p>
<p>So go ahead and try<sup>2</sup> the <a href="http://j.mp/1oVh3SD">USA Outdoors Adventure app</a>. Your feedback or any questions are always welcome!</p>
<footer>
<ol>
<li><a href="http://requirejs.org">Require.js</a> can also be used to manage chained calls between multiple libraries.</li>
<li>Eligibility to enter into competition is explained in app terms.</li>
</ol>
</footer>

    </section>

    
      <section class="more-pagination">
        <h3 class="more-pagination_heading">More articles</h3>
        <section class="more-pagination_content">
          <a rel="prev" class="more-pagination_prev" href="/articles/twitter-uk-developers-meetup/"><span class="more-pagination_guide">&laquo;</span> First ever Twitter UK Developers meetup</a>
          <a rel="next" class="more-pagination_next" href="/articles/making-public-data-more-readable--accessible/">Making public data more readable and accessible <span class="more-pagination_guide">&raquo;</span></a>
        </section>
      </section>
    
  </section>
</section>
</main>
      <footer class="footer container-fluid">
        <div class="container footer_inner">
          <div>
            <p>&copy; 2012 &ndash; present</p>
            <div class="colophone bullets">
              <a target="_blank" rel="noopener noreferrer" href="https://www.twitter.com/jabranr">Twitter</a>
              <a target="_blank" rel="noopener noreferrer" href="https://github.com/jabranr">GitHub</a>
              <a target="_blank" rel="noopener noreferrer" href="https://google.com/mapmaker?gw=66&amp;uid=208599960765438642668">Google Map Maker</a>
              <a href="mailto:hello@jabran.me">Contact</a>
              <a href="/sitemap.xml">RSS</a>
            </div>
            <p><span class="heart">&hearts;</span> I like to develop on ideas that are useful and beneficial to everyone. All contents and code samples are licensed under the MIT License unless stated otherwise.</p>
            <hr />
            <p>This website uses cookies to deliver better user experience. By continuing to use this website you agree to the use of cookies.</p>
          </div>
          
        </div>
      </footer>
    </div>
    
  </body>
</html>
